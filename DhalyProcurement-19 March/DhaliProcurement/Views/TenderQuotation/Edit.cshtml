@model DhaliProcurement.ViewModel.VMTenderMasterDetail
@using DhaliProcurement.Helper
@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="col-md-12">
        <!-- Basic layout-->
        <div class="panel panel-flat">
            <div class="panel-heading">
                <h5 class="panel-title">
                    <i class="icon-stack-plus position-left"></i>Materials Tender Quotation
                    @if (Model.proc_TenderMas.isApproved == "A")
                    {
                        <span class="badge badge-success">Approved</span>
                    }
                    else
                    {
                        <span class="badge badge-danger">Pending Approved</span>
                    }
                </h5><hr />
                <div class="heading-elements">
                    <ul class="icons-list">
                        <li><a data-action="collapse"></a></li>
                    </ul>
                </div>
            </div>
            <div class="panel-body">
                @using (Html.BeginForm())
                {

                    <table class="table">
                        <tr>
                            <td>Tender No.</td>
                            <td>
                                @Html.TextBox("TNo", Model.proc_TenderMas.TNo, new { @class = "form-control" })
                                <input type="hidden" value="@ViewBag.TenderId" id="TenderId" />
                                <span class="error" id="TNo_Error"></span>
                            </td>
                            <td>Tender Date</td>
                            <td>
                                @*@Html.TextBox("TDate", NullHelper.DateToString(Model.proc_TenderMas.TDate), new { @class = "form-control datepicker" })*@
                                @Html.TextBox("TDate", NullHelper.DateToString(Model.proc_TenderMas.TDate), new { @class = "form-control datepicker" })
                            </td>
                        </tr>
                        <tr>
                            <td>Specification</td>
                            <td colspan="3">
                                @Html.TextBox("Specs", Model.proc_TenderMas.Specs, new { @class = "form-control" })
                                <span class="error" id="Specs_Error"></span>
                            </td>
                        </tr>
                        <tr>
                            <td>Remarks</td>
                            <td colspan="3">
                                @Html.TextBox("TenderRemarks", Model.proc_TenderMas.Remarks, new { @class = "form-control" })
                                <span class="error" id="TenderRemarks_Error"></span>
                            </td>
                        </tr>
                    </table>
                    <hr />
                    <div class="details well" style=" border 1px solid black;">
                        <h4>Tender Items</h4>
                        <div class="jumbotron" style="padding:10px;">
                            <table style="width: 100%;">
                                <tr>
                                    <td style="font-weight: bold;" class="col-lg-1">Project</td>
                                    <td class="col-lg-3">
                                        @Html.DropDownList("ProjectId", null, "--Select--", htmlAttributes: new
                                   {
                                       @class = "form-control select2",
                                       @data_required = "required",
                                       @id = "ProjectId"
                                   })
                                    </td>
                                    <td style="font-weight: bold;" class="col-lg-1">Site</td>
                                    <td class="col-lg-3">
                                        @Html.DropDownList("SiteId", null, "--Select--", htmlAttributes: new
                                   {
                                       @class = "form-control select2",
                                       @data_required = "required",
                                       @id = "SiteId"
                                   })
                                    </td>
                                    <td style="font-weight: bold;" class="col-lg-1">Req. No.</td>
                                    <td class="col-lg-3">
                                        @Html.DropDownList("RCode", null, "--Select--", htmlAttributes: new
                                   {
                                       @class = "form-control select2",
                                       @data_required = "required",
                                       @id = "RCode"
                                   })
                                        <input type="hidden" id="Proc_RequisitionDetId" />
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td><span class="error" id="ProjectName_Error" style="padding-left:10px;">Project required</span></td>
                                    <td></td>
                                    <td><span class="error" id="SiteName_Error" style="padding-left:10px;">Site required</span></td>
                                    <td></td>
                                    <td><span class="error" id="ReqNo_Error" style="padding-left:10px;">Req No. required</span></td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;" class="col-lg-1">Item</td>
                                    <td class="col-lg-3">
                                        @Html.DropDownList("ItemName", null, "--Select--", htmlAttributes: new
                                   {
                                       @class = "form-control select2",
                                       @data_required = "required",
                                       @id = "ItemName"
                                   })
                                    </td>
                                    <td style="font-weight: bold;" class="col-lg-1">Qty</td>
                                    <td class="col-lg-3">
                                        <input type="text" id="Qty" class="form-control" disabled="disabled" />
                                    </td>
                                    <td style="font-weight: bold;" class="col-lg-1">Unit</td>
                                    <td class="col-lg-3">
                                        <input type="text" id="UnitName" class="form-control" disabled="disabled" />
                                        <input type="hidden" id="UnitId" value="" />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-lg-1"></td>
                                    <td class="col-lg-3"><span class="error" id="ItemName_Error">Item required</span></td>
                                    <td class="col-lg-1"></td>
                                    <td class="col-lg-3"></td>
                                    <td class="col-lg-1"></td>
                                    <td class="col-lg-3"></td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;" class="col-lg-1">Vendor</td>
                                    <td class="col-lg-3">
                                        @Html.DropDownList("VendorId", null, "--Select--", htmlAttributes: new
                                   {
                                       @class = "form-control select2",
                                       @data_required = "required",
                                       @id = "VendorId"@*, @style = "width: 150px;"*@ })
                                    </td>
                                    <td style="font-weight: bold;" class="col-lg-1">Qtn. No.</td>
                                    <td class="col-lg-3">
                                        <input type="text" id="TQNo" class="form-control" />
                                    </td>
                                    <td style="font-weight: bold;" class="col-lg-1">Qtn. Date</td>
                                    <td class="col-lg-3">
                                        <input type="text" id="TQDate" class="form-control datepicker" />
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td><span class="error" id="VendorName_Error" style="padding-left:10px;">Vendor required</span></td>
                                    <td></td>
                                    <td><span class="error" id="QtnNo_Error" style="padding-left:10px;">Qtn No. required</span></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td style="font-weight: bold;" class="col-lg-1">Unit Price</td>
                                    <td class="col-lg-3">
                                        <input type="text" id="TQPrice" class="form-control" name="unitPrice" />
                                    </td>
                                    <td style="font-weight: bold;" class="col-lg-1">Total Price</td>
                                    <td class="col-lg-3">
                                        <input type="text" id="TotalPrice" class="form-control" disabled="disabled" />
                                    </td>
                                    <td class="col-lg-1"></td>
                                    <td class="col-lg-3">
                                        <input type="button" id="addNewRow" value="ADD" class="btn btn-primary btn-sm" style="background-color: grey;border: none;" />
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td><span class="error" id="UnitPrice_Error" style="padding-left:10px;">Unit Price required</span></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            </table>
                            <br />
                            <div class="table-responsive scrolling">
                                <table class="Resource-list table table-bordered" id="RequisitionDetails">
                                    <thead>
                                        <tr class="bg-grey">
                                            @*<th>Sl. No.</th>*@
                                            <th></th>
                                            <th>Project Name</th>
                                            <th>Site</th>
                                            <th>Req. No.</th>
                                            <th>Item Name</th>
                                            <th>Qty</th>
                                            <th>Unit</th>
                                            <th>Vendor Name</th>
                                            <th>Qtn. No.</th>
                                            <th>Qtn. Date</th>
                                            <th>Unit Price</th>
                                            <th>Total Price</th>
                                            <th>&nbsp;</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                }
            </div>

        </div>

    </div>
    <div class="form-group">
        <div class="col-md-12" style="text-align:center;">
            @*<input type="button" id="deletecheck" value="Delete Selected"/>*@
            @*@Html.ActionLink("Back to List", "Index", null, new { @class = "btn btn-info" ,@style = "background-color: grey;border: none;" })*@
            @if (User.IsInRole("Management"))
            {
                @*if (Model.proc_TenderMas.isApproved.Trim() == "A")
                {
                    <button type="button" id="SaveItem" class="btn btn-success"><i class="icon-floppy-disk position-left"></i>Update</button>
                    <button type="button" id="ApproveItem" class="btn btn-warning"><i class="icon-select2 position-left"></i>Approve Selected</button>
                }
                else
                {
                    <button type="button" id="SaveItem" class="btn btn-success"><i class="icon-floppy-disk position-left"></i>Update</button>
                    <button type="button" id="ApproveItem" class="btn btn-warning"><i class="icon-select2 position-left"></i>Approve Selected</button>
                }*@

                <button type="button" id="SaveItem" class="btn btn-success"><i class="icon-floppy-disk position-left"></i>Update</button>
                <button type="button" id="ApproveItem" class="btn btn-warning"><i class="icon-select2 position-left"></i>Approve Selected</button>
            }
            else
            {
                if (Model.proc_TenderMas.isApproved.Trim() == "A")
                {
                    <button type="button" id="SaveItem" class="btn btn-success"><i class="icon-floppy-disk position-left"></i>Update</button>
                }
                else
                {
                    <button type="button" id="ApproveItem" class="btn btn-warning" disabled="disabled"><i class="icon-floppy-disk position-left"></i>Pending Approval</button>
                }
            }
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="detailForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document" style="overflow-y: scroll; max-height:85%;  margin-top: 50px; margin-bottom:50px;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staffModalTitle">Edit Item</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="panel-body">
                        @Html.AntiForgeryToken()
                        <div class="form-horizontal">
                            <div class="form-group">
                                <input type="hidden" id="ModalTaskId" />
                                <input type="hidden" id="ProjectId" value="" />
                            </div>
                            <div class="form-group">
                                @Html.Label("Project Name", htmlAttributes: new
                           {
                               @class = "control-label col-md-2"@*, @style="font-weight:bold;"*@ })
                                <div class="col-md-10">
                                    @Html.DropDownList("ProjectId", null, "--Select--", htmlAttributes: new { @class = "form-control select2", @data_required = "required", @id = "ModalProjectId" })
                                    <span class="error" id="ModalProjectName_Error"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Site", htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col-md-10">
                                    @*<input type="hidden" id="modalunitId" />*@
                                    @Html.DropDownList("SiteId", null, "--Select--", htmlAttributes: new { @class = "form-control select2", @data_required = "required", @id = "ModalSiteId" })
                                    <span class="error" id="ModalSiteName_Error"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Req No", htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="col-md-10">
                                    <input type="hidden" id="ModalProc_RequisitionDetId" />
                                    @Html.DropDownList("RCode", null, "--Select--", htmlAttributes: new { @class = "form-control select2", @data_required = "required", @id = "ModalRequisition" })
                                    <span class="error" id="ModalReqNo_Error"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Item Name", htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="col-md-10">
                                    <input type="hidden" id="ModalProc_RequisitionDetId" />
                                    @Html.DropDownList("ItemName", null, "--Select--", htmlAttributes: new { @class = "form-control select2", @data_required = "required", @id = "ModalItemName" })
                                    <span class="error" id="ModalItemName_Error"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Qty", htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="col-md-10">
                                    @Html.TextBox("ModalQty", null, new { @class = "form-control", @disabled = "disabled" })
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Unit", htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="col-md-10">
                                    <input type="hidden" id="ModalUnit" />
                                    @Html.TextBox("ModalUnitName", null, new { @class = "form-control" })
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Vendor Name", htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="col-md-10">
                                    @Html.DropDownList("VendorId", null, "--Select--", htmlAttributes: new { @class = "form-control select2", @data_required = "required", @id = "ModalVendor" })
                                    <span class="error" id="ModalVendorName_Error"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Qtn No", htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="col-md-10">
                                    @Html.TextBox("ModalQtnNo", null, new { @class = "form-control" })
                                    <span class="error" id="ModalQtnNo_Error"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Qtn Date", htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="col-md-10">
                                    @Html.TextBox("ModalQtnDate", null, new { @class = "form-control datepicker" })
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Unit Price", htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="col-md-10">
                                    @Html.TextBox("ModalUnitPrice", null, new { @class = "form-control" })
                                    <span class="error" id="ModalUnitPrice_Error"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                @Html.Label("Total", htmlAttributes: new { @class = "control-label col-md-2" })
                                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                <div class="col-md-10">
                                    @Html.TextBox("ModalTotal", null, new { @class = "form-control", @disabled = "disabled" })
                                </div>
                            </div>
                            <div class="modal-footer">
                                <div class="col-md-offset-2 col-md-10">
                                    <button type="submit" class="btn btn-primary" id="ModalDetailSave">Save</button>
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal" id="ModalClose">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var counter = 0;
        var TenderDetailId =0;
        var deleteCounter = 0;
        var deleteList = [];
        var selRow;
        var taskCounter = 0;


        $('#deletecheck').click(function () {
            alert('Length: ' + deleteList.length);
            for(var i = 0;i<deleteList.length;i++)
            {
                alert(deleteList[i]);
            }
        });

        $(document).ready(function () {
            RebindDatePicker();

            $('#SiteId').attr("disabled", "true");
            $("#RCode").attr("disabled", "true");
            $("#ItemName").attr("disabled", "true");

            $('#TNo_Error').hide();
            $('#Specs_Error').hide();
            $('#TenderRemarks_Error').hide();

            $('#ProjectName_Error').hide();
            $('#SiteName_Error').hide();
            $('#ReqNo_Error').hide();
            $('#ItemName_Error').hide();
            $('#VendorName_Error').hide();
            $('#QtnNo_Error').hide();
            $('#UnitPrice_Error').hide();

            $('#ModalProjectName_Error').hide();
            $('#ModalSiteName_Error').hide();
            $('#ModalReqNo_Error').hide();
            $('#ModalItemName_Error').hide();
            $('#ModalVendorName_Error').hide();
            $('#ModalQtnNo_Error').hide();
            $('#ModalUnitPrice_Error').hide();

            $("input[name=TQDate]").datepicker({
                format: 'dd/mm/yyyy',
                todayHighlight: true,
                todayBtn: true,
                autoclose: true
            });

            TenderDetailId  = @ViewBag.TenderDetPrimaryKey;
            var Id = @ViewBag.TenderId;
            $.ajax({
                url: '/TenderQuotation/getEditTender/',
                data: { TenderId: Id},
                dataType: 'json',
                TYPE: 'POST',
                success: function (data) {
                    if(data.flag){
                        @*var userRole = '@(Roles.IsUserInRole("Management") ? "true" : "false")';*@
                        var userRole =  '@(User.IsInRole("Management") ? "true" : "false")';

                        if(userRole.trim()=="true"){

                            for (var i = 0; i < data.List.length; i++) {


                                if(data.List[i].Status=="A"){
                                    counter++;
                                    if(data.List[i].Checkflag ==0){

                                        var row = $('<tr bgcolor="#D0F0C0" style="font-weight:bold;">'
                                           +'<td class="index"><input type="hidden" name="SLNo" value="'+counter+'"/><input type="hidden" name="TenderDetailId" value="'+data.List[i].TenderDetailId+'"/></td>'
                                           + '<td><input value="' + data.List[i].ProjectId + '" type="hidden" name="ProjectId"/><label style="font-weight:bold;width:150px;">' + data.List[i].ProjectName + '<label></td>'
                                           + '<td><input value="' + data.List[i].SiteId + '" type="hidden" name="SiteId"/><label style="font-weight:bold;width:150px;">' + data.List[i].SitetName + '<label></td>'
                                           + '<td><input value="' + data.List[i].RCode + '" type="hidden" name="ReqCode" style="font-weight:bold;"/><label style="font-weight:bold;width:150px;">' + data.List[i].RCodeName + '<label><input value="' + data.List[i].RCodeName + '" type="hidden" name="RCodeName" style="font-weight:bold;"/><input value="' + data.List[i].Proc_RequisitionDetId + '" type="hidden" name="Proc_RequisitionDetId"/></td>'
                                           + '<td><input value="' + data.List[i].ItemId + '" type="hidden" name="ItemId"/><label style="font-weight:bold;width:150px;">' + data.List[i].ItemName + '<label><input value="' + data.List[i].ItemName + '" type="hidden" name="ItemName"/></td>'
                                           + '<td><label style="font-weight:bold;">' + data.List[i].Qty + '<label></td>'
                                           + '<td><input value="' + data.List[i].UnitId + '" type="hidden" name="UnitId"/><label style="font-weight:bold;">' + data.List[i].UnitName + '<label></td>'
                                           + '<td><input value="' + data.List[i].VendorId + '" type="hidden" name="Vendor"/><label style="font-weight:bold;width:150px;">' + data.List[i].VendorName + '<label><input value="' + data.List[i].VendorName + '" type="hidden" name="VendorName"/></td>'
                                           +'<td> <input class="form-control" style="width:110px;" type="hidden" name="TQNo" value="' + data.List[i].TQNo + '" style="font-weight:bold;" /><label style="font-weight:bold;">' + data.List[i].TQNo+ '<label></td>'
                                           +'<td><input class="form-control datepicker" style="width:90px;" type="hidden" name="TQDate" value="' + data.List[i].TQDate + '"/><label style="font-weight:bold;">' + data.List[i].TQDate + '<label></td>'
                                           +'<td><input class="form-control" style="width:70px;" type="hidden" name="TQPrice" value="' + data.List[i].TQPrice + '"/><label style="font-weight:bold;">' + data.List[i].TQPrice + '<label></td>'
                                           //+'<td><label>' + data.List[i].Qty * data.List[i].TQPrice + '<label></label><input value="' + data.List[i].Status + '" type="hidden" name="Status"/></td>'
                                            +'<td><input value="' + data.List[i].Qty * data.List[i].TQPrice + '" type="hidden" name="TotalPrice" class="form-control TotalPrice" style="width:90px;" disabled="disabled"/>'
                                            +'<label style="font-weight:bold;">' +  data.List[i].Qty * data.List[i].TQPrice + '<label>'
                                            +'<input class="Status"  value="'+data.List[i].Status +'" type="hidden" name="Status"/></td>'
                                           //+'<td">'+
                                           //         '<button  onclick="RemoveTask(this)" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded"><i class="icon-cross"></i></button>'+
                                           //         ' <input type="checkbox"  />'+
                                           //         ' <button   type="button"  onclick="AddNewRowAfter(this);"   class="btn  text-success-600 btn-flat btn-icon btn-rounded "><i class=" icon-plus-circle2"></i></button></td>'
                                          +'<td style="width:100px;">'+
                                                    ' <input type="checkbox" checked="checked"/><input type="hidden" name="Checkflag" value="' + data.List[i].Checkflag + '"/>'
                                                    //+'<button  onclick="RemoveTask('+data.List[i].TenderDetailId+')" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded"><i class="icon-cross"></i></button>'
                                                    +'</td>'

                                         +'</tr>');

                                        $('#RequisitionDetails tbody').append(row);
                                        RebindDatePicker()
                                    }
                                    else{

                                        var row = $('<tr bgcolor="#D0F0C0" style="font-weight:bold;">'
                                           +'<td class="index"><input type="hidden" name="SLNo" value="'+counter+'"/><input type="hidden" name="TenderDetailId" value="'+data.List[i].TenderDetailId+'"/></td>'
                                           + '<td><input value="' + data.List[i].ProjectId + '" type="hidden" name="ProjectId"/><label style="font-weight:bold;width:150px;">' + data.List[i].ProjectName + '<label></td>'
                                           + '<td><input value="' + data.List[i].SiteId + '" type="hidden" name="SiteId"/><label style="font-weight:bold;width:150px;">' + data.List[i].SitetName + '<label></td>'
                                           + '<td><input value="' + data.List[i].RCode + '" type="hidden" name="ReqCode" style="font-weight:bold;"/><label style="font-weight:bold;width:150px;">' + data.List[i].RCodeName + '<label><input value="' + data.List[i].RCodeName + '" type="hidden" name="RCodeName" style="font-weight:bold;"/><input value="' + data.List[i].Proc_RequisitionDetId + '" type="hidden" name="Proc_RequisitionDetId"/></td>'
                                           + '<td><input value="' + data.List[i].ItemId + '" type="hidden" name="ItemId"/><label style="font-weight:bold;width:150px;">' + data.List[i].ItemName + '<label><input value="' + data.List[i].ItemName + '" type="hidden" name="ItemName"/></td>'
                                           + '<td><label style="font-weight:bold;">' + data.List[i].Qty + '<label></td>'
                                           + '<td><input value="' + data.List[i].UnitId + '" type="hidden" name="UnitId"/><label style="font-weight:bold;">' + data.List[i].UnitName + '<label></td>'
                                           + '<td><input value="' + data.List[i].VendorId + '" type="hidden" name="Vendor"/><label style="font-weight:bold;width:150px;">' + data.List[i].VendorName + '<label><input value="' + data.List[i].VendorName + '" type="hidden" name="VendorName"/></td>'
                                           +'<td> <input class="form-control" style="width:110px;" type="hidden" name="TQNo" value="' + data.List[i].TQNo + '" style="font-weight:bold;" /><label style="font-weight:bold;">' + data.List[i].TQNo+ '<label></td>'
                                           +'<td><input class="form-control datepicker" style="width:90px;" type="hidden" name="TQDate" value="' + data.List[i].TQDate + '"/><label style="font-weight:bold;">' + data.List[i].TQDate + '<label></td>'
                                           +'<td><input class="form-control" style="width:70px;" type="hidden" name="TQPrice" value="' + data.List[i].TQPrice + '"/><label style="font-weight:bold;">' + data.List[i].TQPrice + '<label></td>'
                                           //+'<td><label>' + data.List[i].Qty * data.List[i].TQPrice + '<label></label><input value="' + data.List[i].Status + '" type="hidden" name="Status"/></td>'
                                            +'<td><input value="' + data.List[i].Qty * data.List[i].TQPrice + '" type="hidden" name="TotalPrice" class="form-control TotalPrice" style="width:90px;" disabled="disabled"/>'
                                            +'<label style="font-weight:bold;">' +  data.List[i].Qty * data.List[i].TQPrice + '<label>'
                                            +'<input class="Status"  value="'+data.List[i].Status +'" type="hidden" name="Status"/></td>'
                                           //+'<td">'+
                                           //         '<button  onclick="RemoveTask(this)" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded"><i class="icon-cross"></i></button>'+
                                           //         ' <input type="checkbox"  />'+
                                           //         ' <button   type="button"  onclick="AddNewRowAfter(this);"   class="btn  text-success-600 btn-flat btn-icon btn-rounded "><i class=" icon-plus-circle2"></i></button></td>'
                                          +'<td style="width:100px;">'+
                                                    ' <input type="checkbox" checked="checked" style="display:none"/><input type="hidden" name="Checkflag" value="' + data.List[i].Checkflag + '"/>'
                                                    //+'<button  onclick="RemoveTask('+data.List[i].TenderDetailId+')" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded"><i class="icon-cross"></i></button>'
                                                    +'</td>'

                                         +'</tr>');

                                        $('#RequisitionDetails tbody').append(row);
                                        RebindDatePicker()
                                    }

                                }
                                else{
                                    counter++;
                                    var row = $('<tr>'
                                       +'<td class="index"><input type="hidden" name="SLNo" value="'+counter+'"/><input type="hidden" name="TenderDetailId" value="'+data.List[i].TenderDetailId+'"/></td>'
                                       + '<td><input value="' + data.List[i].ProjectId + '" type="hidden" name="ProjectId"/><label name="label_ProjectName" style="width:150px;">'+ data.List[i].ProjectName + '</label><input class="form-control" value="' + data.List[i].ProjectName + '" type="hidden" name="ProjectName" style="width:90px;" disabled="disabled"/></td>'
                                       + '<td><input value="' + data.List[i].SiteId + '" type="hidden" name="SiteId"/><label name="label_SiteName" style="width:150px;">' + data.List[i].SitetName + '</label><input class="form-control" value="' + data.List[i].SitetName + '" type="hidden" name="SiteName" style="width:90px;"  disabled="disabled"/></td>'
                                       + '<td><input value="' + data.List[i].RCode + '" type="hidden" class="form-control" name="ReqCode"  style="width:150px;"/><label name="label_RCodeName" style="width:150px;">' + data.List[i].RCodeName + '</label><input value="' + data.List[i].RCodeName+ '" type="hidden" class="form-control" name="RCodeName"  style="width:90px;"  disabled="disabled"/><input value="' + data.List[i].Proc_RequisitionDetId + '" type="hidden" name="Proc_RequisitionDetId"/></td>'
                                       + '<td><input value="' + data.List[i].ItemId + '" type="hidden" name="ItemId"/><label name="label_ItemName" style="width:150px;">' + data.List[i].ItemName + '</label><input value="' + data.List[i].ItemName + '" type="hidden" class="form-control" name="ItemName"  style="width:90px;"  disabled="disabled"/></td>'
                                       + '<td><input class="form-control" value="' + data.List[i].Qty  + '" type="hidden" name="Qty" style="width:90px;" disabled="disabled"/><label name="label_Qty">' + data.List[i].Qty  + '</label></td>'
                                       + '<td><input value="' + data.List[i].UnitId + '" type="hidden" name="UnitId"/><label name="label_UnitName">' + data.List[i].UnitName + '</label><input class="form-control" value="' + data.List[i].UnitName + '" type="hidden" name="UnitName" disabled="disabled" style="width:90px;"/></td>'
                                       + '<td><input value="' + data.List[i].VendorId + '" type="hidden" name="Vendor"/><label name="label_VendorName" style="width:150px;">' + data.List[i].VendorName + '</label><input value="' + data.List[i].VendorName + '" type="hidden" class="form-control" name="VendorName"  disabled="disabled"  style="width:90px;"/></td>'
                                       + '<td><input class="form-control" style="width:110px;" type="hidden" name="TQNo" value="' + data.List[i].TQNo + '" /><label name="label_TQNo">' + data.List[i].TQNo + '</label></td>'
                                       + '<td><input class="form-control datepicker" style="width:90px;" type="hidden" name="TQDate" value="' + data.List[i].TQDate + '"/><label name="label_TQDate">' + data.List[i].TQDate + '</label></td>'
                                       + '<td><input class="form-control" style="width:70px;" type="hidden" name="TQPrice" value="' + data.List[i].TQPrice + '"/><label name="label_TQPrice">' + data.List[i].TQPrice + '</label></td>'
                                       + '<td><input value="' + data.List[i].Qty * data.List[i].TQPrice + '" type="hidden" name="TotalPrice" class="form-control TotalPrice" style="width:90px;" disabled="disabled"/><label name="label_TotalPrice">' + data.List[i].Qty * data.List[i].TQPrice + '</label><input class="Status"  value="'+data.List[i].Status +'" type="hidden" name="Status"/></td>'
                                       + '<td style="width:100px;">'+
                                                '<input type="checkbox"/><input type="hidden" name="Checkflag" value="' + data.List[i].Checkflag + '"/>'
                                                  + '<button type="button" id="editSite" class="btn text-primary-400 btn-flat btn-icon btn-rounded  btn-xs editSite " data-toggle="modal" data-target="#detailForm"><i class="icon-pencil"></i></button>'
                                                  +'<button class="btn text-warning-600 btn-flat btn-icon btn-rounded deleteDetailTask"><i class="icon-cross"></i></button>'+
                                                    //+' <input type="button" class="btn btn-danger btn-xs deleteDetailTask" value="Delete"/>'+
                                                //+'<button  onclick="RemoveTask('+data.List[i].TenderDetailId+')" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded"><i class="icon-cross"></i></button>'+
                                                '</td>'

                                       +'</tr>');

                                    $('#RequisitionDetails tbody').append(row);

                                    RebindDatePicker()
                                }
                            }
                        }

                            //operator
                        else{
                            for (var i = 0; i < data.List.length; i++) {

                                if(data.List[i].Status=="A"){
                                    counter++;
                                    if(data.List[i].Checkflag ==0){
                                        var row = $('<tr bgcolor="#D0F0C0" style="font-weight:bold;">'
                                              +'<td class="index"><input type="hidden" name="SLNo" value="'+counter+'"/><input type="hidden" name="TenderDetailId" value="'+data.List[i].TenderDetailId+'"/></td>'
                                              + '<td><input value="' + data.List[i].ProjectId + '" type="hidden" name="ProjectId"/><label style="font-weight:bold;">' + data.List[i].ProjectName + '<label></td>'
                                              + '<td><input value="' + data.List[i].SiteId + '" type="hidden" name="SiteId"/><label style="font-weight:bold;">' + data.List[i].SitetName + '<label></td>'
                                              + '<td><input value="' + data.List[i].RCode + '" type="hidden" name="ReqCode"/><label style="font-weight:bold;">' + data.List[i].RCodeName + '<label><input value="' + data.List[i].Proc_RequisitionDetId + '" type="hidden" name="Proc_RequisitionDetId"/></td>'
                                              + '<td><input value="' + data.List[i].ItemId + '" type="hidden" name="ItemId"/><label style="font-weight:bold;">' + data.List[i].ItemName + '<label><input value="' + data.List[i].ItemName + '" type="hidden" name="ItemName"/></td>'
                                              + '<td><label style="font-weight:bold;">' + data.List[i].Qty + '<label></td>'
                                              + '<td><input  value="' + data.List[i].UnitId + '" type="hidden" name="UnitId"/><label style="font-weight:bold;">' + data.List[i].UnitName + '<label></td>'
                                              + '<td><input value="' + data.List[i].VendorId + '" type="hidden" name="Vendor"/><label style="font-weight:bold;">' + data.List[i].VendorName + '<label><input value="' + data.List[i].VendorName + '" type="hidden" name="VendorName"/></td>'
                                              +'<td> <input class="form-control" style="width:110px;" type="hidden" name="TQNo" value="' + data.List[i].TQNo + '" /><label style="font-weight:bold;">' + data.List[i].TQNo + '<label></td>'
                                              +'<td><input class="form-control datepicker" style="width:90px;" type="hidden" name="TQDate" value="' + data.List[i].TQDate + '"/><label style="font-weight:bold;">' + data.List[i].TQDate  + '<label></td>'
                                              +'<td><input class="form-control" style="width:70px;" type="hidden" name="TQPrice" value="' + data.List[i].TQPrice + '"/><label style="font-weight:bold;">' + data.List[i].TQPrice  + '<label></td>'
                                              //+'<td><label>' + data.List[i].Qty * data.List[i].TQPrice + '<label></label><input value="' + data.List[i].Status + '" type="hidden" name="Status"/></td>'
                                               +'<td><input value="' + data.List[i].Qty * data.List[i].TQPrice + '" type="text" name="TotalPrice" class="form-control TotalPrice" style="width:90px;" disabled="disabled"/><input class="Status"  value="'+data.List[i].Status +'" type="hidden" name="Status"/></td>'
                                              //+'<td">'+
                                              //         '<button  onclick="RemoveTask(this)" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded"><i class="icon-cross"></i></button>'+
                                              //         ' <input type="checkbox"  />'+
                                              //         ' <button   type="button"  onclick="AddNewRowAfter(this);"   class="btn  text-success-600 btn-flat btn-icon btn-rounded "><i class=" icon-plus-circle2"></i></button></td>'
                                             +'<td style="width:100px;">'+
                                                       '<input type="checkbox" checked="checked" style="display:none"/><input type="hidden" name="Checkflag" value="' + data.List[i].Checkflag + '"/>'
                                                       //+'<button type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded deleteDetailTask"><i class="icon-cross"></i></button>'+
                                                       //+'<button  onclick="RemoveTask('+data.List[i].TenderDetailId+')" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded" style="display:none"><i class="icon-cross"></i></button>'+
                                                      + ' </td>'
                                            +'</tr>');

                                        $('#RequisitionDetails tbody').append(row);
                                        RebindDatePicker()
                                    }
                                    else{
                                        var row = $('<tr bgcolor="#D0F0C0" style="font-weight:bold;">'
                                             +'<td class="index"><input type="hidden" name="SLNo" value="'+counter+'"/><input type="hidden" name="TenderDetailId" value="'+data.List[i].TenderDetailId+'"/></td>'
                                             + '<td><input value="' + data.List[i].ProjectId + '" type="hidden" name="ProjectId"/><label style="font-weight:bold;">' + data.List[i].ProjectName + '<label></td>'
                                             + '<td><input value="' + data.List[i].SiteId + '" type="hidden" name="SiteId"/><label style="font-weight:bold;">' + data.List[i].SitetName + '<label></td>'
                                             + '<td><input value="' + data.List[i].RCode + '" type="hidden" name="ReqCode"/><label style="font-weight:bold;">' + data.List[i].RCodeName + '<label><input value="' + data.List[i].Proc_RequisitionDetId + '" type="hidden" name="Proc_RequisitionDetId"/></td>'
                                             + '<td><input value="' + data.List[i].ItemId + '" type="hidden" name="ItemId"/><label style="font-weight:bold;">' + data.List[i].ItemName + '<label><input value="' + data.List[i].ItemName + '" type="hidden" name="ItemName"/></td>'
                                             + '<td><label style="font-weight:bold;">' + data.List[i].Qty + '<label></td>'
                                             + '<td><input  value="' + data.List[i].UnitId + '" type="hidden" name="UnitId"/><label style="font-weight:bold;">' + data.List[i].UnitName + '<label></td>'
                                             + '<td><input value="' + data.List[i].VendorId + '" type="hidden" name="Vendor"/><label style="font-weight:bold;">' + data.List[i].VendorName + '<label><input value="' + data.List[i].VendorName + '" type="hidden" name="VendorName"/></td>'
                                             +'<td> <input class="form-control" style="width:110px;" type="hidden" name="TQNo" value="' + data.List[i].TQNo + '" /><label style="font-weight:bold;">' + data.List[i].TQNo + '<label></td>'
                                             +'<td><input class="form-control datepicker" style="width:90px;" type="hidden" name="TQDate" value="' + data.List[i].TQDate + '"/><label style="font-weight:bold;">' + data.List[i].TQDate  + '<label></td>'
                                             +'<td><input class="form-control" style="width:70px;" type="hidden" name="TQPrice" value="' + data.List[i].TQPrice + '"/><label style="font-weight:bold;">' + data.List[i].TQPrice  + '<label></td>'
                                             //+'<td><label>' + data.List[i].Qty * data.List[i].TQPrice + '<label></label><input value="' + data.List[i].Status + '" type="hidden" name="Status"/></td>'
                                              +'<td><input value="' + data.List[i].Qty * data.List[i].TQPrice + '" type="text" name="TotalPrice" class="form-control TotalPrice" style="width:90px;" disabled="disabled"/><input class="Status"  value="'+data.List[i].Status +'" type="hidden" name="Status"/></td>'
                                             //+'<td">'+
                                             //         '<button  onclick="RemoveTask(this)" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded"><i class="icon-cross"></i></button>'+
                                             //         ' <input type="checkbox"  />'+
                                             //         ' <button   type="button"  onclick="AddNewRowAfter(this);"   class="btn  text-success-600 btn-flat btn-icon btn-rounded "><i class=" icon-plus-circle2"></i></button></td>'
                                            +'<td style="width:100px;">'+
                                                      '<input type="checkbox" checked="checked" style="display:none"/><input type="hidden" name="Checkflag" value="' + data.List[i].Checkflag + '"/>'
                                                      //+'<button type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded deleteDetailTask"><i class="icon-cross"></i></button>'+
                                                      //+'<button  onclick="RemoveTask('+data.List[i].TenderDetailId+')" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded" style="display:none"><i class="icon-cross"></i></button>'+
                                                     + ' </td>'
                                           +'</tr>');

                                        $('#RequisitionDetails tbody').append(row);
                                        RebindDatePicker()
                                    }

                                }
                                else{
                                    counter++;
                                    var row = $('<tr>'
                                       +'<td class="index"><input type="hidden" name="SLNo" value="'+counter+'"/><input type="hidden" name="TenderDetailId" value="'+data.List[i].TenderDetailId+'"/></td>'
                                      + '<td><input value="' + data.List[i].ProjectId + '" type="hidden" name="ProjectId"/><label name="label_ProjectName">' + data.List[i].ProjectName  + '</label><input class="form-control" value="' + data.List[i].ProjectName + '" type="hidden" name="ProjectName" style="width:90px;" disabled="disabled"/></td>'
                                       + '<td><input value="' + data.List[i].SiteId + '" type="hidden" name="SiteId"/><label name="label_SiteName">' + data.List[i].SitetName  + '</label><input class="form-control" value="' + data.List[i].SitetName + '" type="hidden" name="SiteName" style="width:90px;" disabled="disabled"/></td>'
                                       + '<td><input value="' + data.List[i].RCode + '" type="hidden" class="form-control" name="ReqCode"  style="width:90px;"/><label name="label_RCodeName">' + data.List[i].RCodeName + '</label><input value="' + data.List[i].RCodeName + '" type="hidden" class="form-control" name="RCodeName"  style="width:90px;" disabled="disabled"/><input value="' + data.List[i].Proc_RequisitionDetId + '" type="hidden" name="Proc_RequisitionDetId"/></td>'
                                       + '<td><input value="' + data.List[i].ItemId + '" type="hidden" name="ItemId"/><label name="label_ItemName">' + data.List[i].ItemName  + '</label><input value="' + data.List[i].ItemName + '" type="hidden" class="form-control" name="ItemName"  style="width:90px;" disabled="disabled"/></td>'
                                       + '<td><input class="form-control" value="' + data.List[i].Qty  + '" type="hidden" name="Qty" style="width:90px;" disabled="disabled"/><label name="label_Qty">' +  data.List[i].Qty  + '</label></td>'
                                       + '<td><input  value="' + data.List[i].UnitId + '" type="hidden" name="UnitId"/><label name="label_UnitName">' + data.List[i].UnitName + '</label><input class="form-control" value="' + data.List[i].UnitName + '" type="hidden" name="UnitName" disabled="disabled" style="width:80px;"/></td>'
                                       + '<td><input value="' + data.List[i].VendorId + '" type="hidden" name="Vendor"/><label>' + data.List[i].VendorName + '<label><input value="' + data.List[i].VendorName + '" type="hidden" name="VendorName"/></td>'
                                       +'<td> <input class="form-control" style="width:110px;" type="text" name="TQNo" value="' + data.List[i].TQNo + '" /><label name="label_TQNo">' + data.List[i].TQNo + '</label></td>'
                                       +'<td><input class="form-control datepicker" style="width:90px;" type="hidden" name="TQDate" value="' + data.List[i].TQDate + '"/><label name="label_TQDate">' + data.List[i].TQDate + '</label></td>'
                                       +'<td><input class="form-control" style="width:70px;" type="hidden" name="TQPrice" value="' + data.List[i].TQPrice + '"/><label name="label_TQPrice">' + data.List[i].TQPrice + '</label></td>'
                                       +'<td><input value="' + data.List[i].Qty * data.List[i].TQPrice + '" type="hidden" name="TotalPrice" class="form-control TotalPrice" style="width:90px;" disabled="disabled"/><label name="label_TotalPrice">' + data.List[i].Qty * data.List[i].TQPrice + '</label><input class="Status"  value="'+data.List[i].Status +'" type="hidden" name="Status"/></td>'
                                       +'<td style="width:100px;">'+
                                                '<input type="checkbox" style="display:none"/><input type="hidden" name="Checkflag" value="' + data.List[i].Checkflag + '"/>'
                                                  + '<button type="button" id="editSite" class="btn text-primary-400 btn-flat btn-icon btn-rounded  btn-xs editSite " data-toggle="modal" data-target="#detailForm"><i class="icon-pencil"></i></button>'
                                                +'<button type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded deleteDetailTask"><i class="icon-cross"></i></button>'+
                                                //+'<button  onclick="RemoveTask('+data.List[i].TenderDetailId+')" type="button" class="btn  text-warning-600 btn-flat btn-icon btn-rounded"><i class="icon-cross"></i></button>'+
                                                ' </td>'

                                       +'</tr>');

                                    $('#RequisitionDetails tbody').append(row);

                                    RebindDatePicker();
                                }




                            }


                        }

                    }

                    $('.editSite').click(function () {

                        var row = $(this).closest('tr');
                        selRow = $(this).closest('tr');

                        var TaskId = row.find('input[name=SLNo]').val();
                        var ProjectId = row.find('input[name=ProjectId]').val();
                        var ProjectName = row.find('input[name=ProjectName]').val();
                        var SiteId = row.find('input[name=SiteId]').val();
                        var SiteName = row.find('input[name=SiteName]').val();
                        var RCode = row.find('input[name=ReqCode]').val();
                        var itemId = row.find('input[name=ItemId]').val();
                        var Proc_RequisitionDetId = row.find('input[name=Proc_RequisitionDetId]').val();
                        var Qty = row.find('input[name=Qty]').val();
                        var UnitId = row.find('input[name=UnitId]').val();
                        var UnitName = row.find('input[name=UnitName]').val();
                        var Vendor = row.find('input[name=Vendor]').val();
                        var TQNo = row.find('input[name=TQNo]').val();
                        var TQDate = row.find('input[name=TQDate]').val();
                        var TQPrice = row.find('input[name=TQPrice]').val();
                        var TotalPrice = row.find('input[name=TotalPrice]').val();

                        var Checkflag = row.find('input[name=Checkflag]').val();

                        //alert(Checkflag);

                        //if(Checkflag==0)
                        //{
                        //    $('#ModalItemName').removeAttr("disabled");
                        //}
                        //else{
                        //    $("#ModalItemName").attr("disabled", "true");
                        //}


                        RebindModalfields(ProjectId, SiteId, RCode, itemId);

                        $('#ModalTaskId').val(TaskId);
                        $('#ModalProjectId').val(ProjectId);
                        //$('#ModalSiteId').val(SiteId);
                        //$('#ModalRequisition').val(RCode);
                        //$('#ModalItemName').val(itemId);
                        $('#ModalProc_RequisitionDetId').val(Proc_RequisitionDetId);
                        $('#ModalQty').val(Qty);
                        $('#ModalUnit').val(UnitId);
                        $('#ModalUnitName').val(UnitName);
                        $('#ModalVendor').val(Vendor);
                        $('#ModalQtnNo').val(TQNo);
                        $('#ModalQtnDate').val(TQDate);
                        $('#ModalUnitPrice').val(TQPrice);
                        $('#ModalTotal').val(TotalPrice);


                        //$('#ModalSiteId').attr("disabled", "true");
                        //$('#ModalRequisition').attr("disabled", "true");
                        //$('#ModalItemName').attr("disabled", "true");
                        $('#ModalQty').attr("disabled", "true");
                        $('#ModalUnitName').attr("disabled", "true");
                        $('#ModalTotal').attr("disabled", "true");
                    });



                    $('.deleteDetailTask').click(function (e) {
                        e.preventDefault();
                        //var retVal = confirm("Do you want to delete this Item ?");
                        //if (retVal == true) {
                        var row = $(this).closest('tr');
                        var itemDetId = $(this).closest('tr').find('td input[name=TenderDetailId]').val();

                        RequisitionDelete = JSON.stringify({
                            TenderDetailId: itemDetId
                        });

                        $.ajax({
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            type: 'POST',
                            url: '/TenderQuotation/DeleteTenderDetailItem',
                            data: RequisitionDelete,
                            success: function (result) {
                                console.log(result);
                                if (result.flag === true) {
                                    deleteList[deleteCounter] = itemDetId;
                                    deleteCounter++;
                                    row.remove();
                                }
                                else {
                                    alert(result.message);
                                }


                            },
                            failure: function (response) {
                                alert('error');
                            }
                        });

                        //}
                        //else {
                        //    return false;
                        //}

                    });

                },
                error: function (jqXHR, textStatus, errorThrown) {

                }

            });


        });

        function RebindModalfields(ProjectId, SiteId, RCode, itemId) {
            $.ajax({
                type: "post",
                url: "/TenderQuotation/RebindModal",
                data: {ProjectId: ProjectId,SiteId: SiteId,RCode: RCode,itemId: itemId },
                datatype: "json",
                traditional: true,
                success: function (data) {
                    var listOfSites = data.Sites.length;
                    var sites = "<select id='ModalSiteId'>";
                    sites = sites + '<option value="">--Select--</option>';
                    for (var i = 0; i < listOfSites; i++) {
                        sites = sites + '<option value=' + data.Sites[i].Value + '>' + data.Sites[i].Text + '</option>';
                    }
                    sites = sites + '</select>';
                    $('#ModalSiteId').html(sites);
                    $('#ModalSiteId').val(SiteId);

                    var listOfReqs = data.Reqs.length;
                    var Reqs = "<select id=''>";
                    Reqs = Reqs + '<option value="">--Select--</option>';
                    for (var i = 0; i < listOfReqs; i++) {
                        Reqs = Reqs + '<option value=' + data.Reqs[i].Value + '>' + data.Reqs[i].Text + '</option>';
                    }
                    Reqs = Reqs + '</select>';
                    $('#ModalRequisition').html(Reqs);
                    $('#ModalRequisition').val(RCode);

                    var listOfitems = data.Items.length;
                    var Items = "<select id=''>";
                    Items = Items + '<option value="">--Select--</option>';
                    for (var i = 0; i < listOfitems; i++) {
                        Items = Items + '<option value=' + data.Items[i].Value + '>' + data.Items[i].Text + '</option>';
                    }
                    Items = Items + '</select>';
                    $('#ModalItemName').html(Items);
                    $('#ModalItemName').val(itemId);
                }

            });
        }

        $('#ModalDetailSave').click(function () {
            var isAllValid = true;

            var TaskId = $('#ModalTaskId').val();
            var ModalProjectId = $('#ModalProjectId option:selected').val();
            var ModalProjectName = $('#ModalProjectId option:selected').text();
            var ModalSiteId = $('#ModalSiteId option:selected').val();
            var ModalSiteName = $('#ModalSiteId option:selected').text();
            var ModalRequisition = $('#ModalRequisition option:selected').val();
            var ModalRCodeName =  $('#ModalRequisition option:selected').text();
            var ModalItemId = $('#ModalItemName option:selected').val();
            var ModalItemName = $('#ModalItemName option:selected').text();
            var ModalQty = $('#ModalQty').val();
            var ModalUnit = $('#ModalUnit').val();
            var ModalUnitName = $('#ModalUnitName').val();
            var ModalVendorId = $('#ModalVendor option:selected').val();
            var ModalVendorName = $('#ModalVendor option:selected').text();
            var ModalQtnNo = $('#ModalQtnNo').val();
            var ModalQtnDate = $('#ModalQtnDate').val();
            var ModalProc_RequisitionDetId = $('#ModalProc_RequisitionDetId').val();
            var ModalUnitPrice = $('#ModalUnitPrice').val();
            var ModalTotal = $('#ModalTotal').val();

            if (ModalProjectName.trim() == "" || ModalProjectName.trim() == "--Select--") {
                $('#ModalProjectName_Error').text("Project required").show();
                isAllValid = false;
            }
            else {
                $('#ModalProjectName_Error').hide();
            }
            if (ModalSiteName.trim() == "" || ModalSiteName.trim() == "--Select--") {
                $('#ModalSiteName_Error').text("Site required").show();
                isAllValid = false;
            }
            else {
                $('#ModalSiteName_Error').hide();
            }
            if (ModalRCodeName.trim() == "" || ModalRCodeName.trim() == "--Select--") {
                $('#ModalReqNo_Error').text("Requisition required").show();
                isAllValid = false;
            }
            else {
                $('#ModalReqNo_Error').hide();
            }
            if (ModalItemName.trim() == "" || ModalItemName.trim() == "--Select--") {
                $('#ModalItemName_Error').text("Item required").show();
                isAllValid = false;
            }
            else {
                $('#ModalItemName_Error').hide();
            }
            if (ModalVendorName.trim() == "" || ModalVendorName.trim() == "--Select--") {
                $('#ModalVendorName_Error').text("Vendor required").show();
                isAllValid = false;
            }
            else {
                $('#ModalVendorName_Error').hide();
            }
            //if (ModalUnitPrice.trim() == "") {
            //    $('#ModalUnitPrice_Error').text("Unit Price required").show();
            //    isAllValid = false;
            //}
            //else {
            //    $('#ModalUnitPrice_Error').hide();
            //}
            //if(ModalUnitPrice.trim()!=""){
            //    if(isNaN(ModalUnitPrice.trim())){
            //        $('#ModalUnitPrice_Error').text("Unit Price must be a numeric value!").show();
            //        isAllValid = false;
            //    }
            //    else{
            //        $('#ModalUnitPrice_Error').hide();
            //    }
            //}

            if (ModalUnitPrice.trim() == "") {
                $('#ModalUnitPrice_Error').text("Unit Price required").show();
                isAllValid = false;
            }
            else {
                if(isNaN(ModalUnitPrice.trim())){
                    $('#ModalUnitPrice_Error').text("Unit Price must be a numeric value!").show();
                    isAllValid = false;
                }
                else{
                    if (ModalUnitPrice.trim().length > 18) {
                        isAllValid = false;
                        $('#ModalUnitPrice_Error').text("Unit price can not be greater than 18 characters!").show();
                    }
                    else {
                        $('#ModalUnitPrice_Error').hide();
                    }
                }
            }

            if (ModalQtnNo.trim().length > 50) {
                $('#ModalQtnNo_Error').text("Qtn No. can not be greater than 50 characters!").show();
                isAllValid = false;
            }
            else {
                $('#ModalQtnNo_Error').hide();
            }

            //validation for checking duplicate item
            $('table.Resource-list tbody tr').each(function () {
                var Itemname = $(this).find("td input[name=ItemId]").val();
                var Vendorname = $(this).find("td input[name=Vendor]").val();
                var task = $(this).find("td input[name=SLNo]").val();
                //alert(task+'-->'+TaskId);
                if (task != TaskId.trim()) {
                    if (ModalItemId.trim() == Itemname.trim() && ModalVendorId.trim() == Vendorname.trim()) {
                        alert('Same Vendor against this item exists!');
                        isAllValid = false;
                    }
                }
            });

            if (isAllValid) {
                selRow.find('input[name=ProjectId]').val(ModalProjectId);
                selRow.find('input[name=ProjectName]').val(ModalProjectName);
                selRow.find('input[name=SiteId]').val(ModalSiteId);
                selRow.find('input[name=SiteName]').val(ModalSiteName);
                selRow.find('input[name=ReqCode]').val(ModalRequisition);
                selRow.find('input[name=ItemId]').val(ModalItemId);
                selRow.find('input[name=ItemName]').val(ModalItemName);
                selRow.find('input[name=Proc_RequisitionDetId]').val(ModalProc_RequisitionDetId);
                selRow.find('input[name=Qty]').val(ModalQty);
                selRow.find('input[name=UnitName]').val(ModalUnitName);
                selRow.find('input[name=UnitId]').val(ModalUnit);
                selRow.find('input[name=Vendor]').val(ModalVendorId);
                selRow.find('input[name=VendorName]').val(ModalVendorName);
                selRow.find('input[name=TQNo]').val(ModalQtnNo);
                selRow.find('input[name=TQDate]').val(ModalQtnDate);
                selRow.find('input[name=TQPrice]').val(ModalUnitPrice);
                selRow.find('input[name=TotalPrice]').val(ModalTotal);

                selRow.find('label[name=label_ProjectName]').text(ModalProjectName);
                selRow.find('label[name=label_SiteName]').text(ModalSiteName);
                selRow.find('label[name=label_RCodeName]').text(ModalRCodeName);
                selRow.find('label[name=label_ItemName]').val(ModalItemName);
                selRow.find('label[name=label_Qty]').text(ModalQty);
                selRow.find('label[name=label_UnitName]').text(ModalUnitName);
                selRow.find('label[name=label_VendorName]').text(ModalVendorName);
                selRow.find('label[name=label_TQNo]').text(ModalQtnNo);
                selRow.find('label[name=label_TQDate]').text(ModalQtnDate);
                selRow.find('label[name=label_TQPrice]').text(ModalUnitPrice);
                selRow.find('label[name=label_TotalPrice]').text(ModalTotal);

                $('#detailForm').modal('hide');
                //totalItemCost();
            }
        });

        $('#ModalClose').click(function () {
            $('#ModalProjectName_Error').hide();
            $('#ModalSiteName_Error').hide();
            $('#ModalReqNo_Error').hide();
            $('#ModalItemName_Error').hide();
            $('#VendorName_Error').hide();
            $('#ModalUnitPrice_Error').hide();
            $('#ModalQtnNo_Error').hide();
        });

        $('#ModalProjectId').change(function () {
            var id = $('#ModalProjectId option:selected').val();
            if ($('#ModalProjectId option:selected').text() == "--Select--") {
                $('#ModalSiteId').empty();
                $('#ModalRequisition').empty();
                $('#ModalItemName').empty();
                var sites = "<select id='sites'><option value=''>--Select--</option></select>";
                $('#ModalSiteId').html(sites);
                $('#ModalRequisition').html(sites);
                $('#ModalItemName').html(sites);
                $('#ModalUnit').val("");
                $('#ModalUnitName').val("");
                $('#ModalQty').val("");
                $('#ModalVendor').val("");
                $('#ModalQtnNo').val("");
                $('#ModalQtnDate').val("");
                $('#ModalUnitPrice').val("");
                $('#ModalTotal').val("");
            }
            else {
                $.ajax({
                    url: "/TenderQuotation/GetSites",
                    type: "post",
                    data: {
                        ProjectId: id
                    },
                    dataType: "json",
                    success: function (data) {
                        var listOfSites = data.Sites.length;
                        $('#ModalSiteId').removeAttr("disabled");
                        $('#ModalSiteId').empty();
                        $('#ModalRequisition').empty();
                        $('#ModalItemName').empty();
                        var sites = "<select id='sites'><option value=''>--Select--</option></select>";
                        $('#ModalRequisition').html(sites);
                        $('#ModalItemName').html(sites);
                        $('#ModalUnit').val("");
                        $('#ModalUnitName').val("");
                        $('#ModalQty').val("");
                        $('#ModalVendor').val("");
                        $('#ModalQtnNo').val("");
                        $('#ModalQtnDate').val("");
                        $('#ModalUnitPrice').val("");
                        $('#ModalTotal').val("");


                        var sites = "<select id='ModalSiteId'>";
                        sites = sites + '<option value="">--Select--</option>';
                        for (var i = 0; i < listOfSites; i++) {
                            sites = sites + '<option value=' + data.Sites[i].Value + '>' + data.Sites[i].Text + '</option>';
                        }
                        sites = sites + '</select>';
                        $('#ModalSiteId').html(sites);

                    },
                    error: function (xhr) {
                        alert('error');
                    }
                });
            }
        });

        $("#ModalSiteId").change(function () {
            var SiteId = $('#ModalSiteId option:selected ').val();
            var ProjectId = $('#ModalProjectId option:selected').val();

            if ($('#ModalSiteId option:selected ').text() == "--Select--") {
                $('#ModalRequisition').empty();
                $('#ModalItemName').empty();
                var sites = "<select id='sites'><option value=''>--Select--</option></select>";
                $('#ModalRequisition').html(sites);
                $('#ModalItemName').html(sites);
                $('#ModalUnit').val("");
                $('#ModalUnitName').val("");
                $('#ModalQty').val("");
                $('#ModalVendor').val("");
                $('#ModalQtnNo').val("");
                $('#ModalQtnDate').val("");
                $('#ModalUnitPrice').val("");
                $('#ModalTotal').val("");
            }
            else {
                $.ajax({
                    type: "post",
                    url: "/TenderQuotation/GetReqNo",
                    data: { SiteId, ProjectId },
                    datatype: "json",
                    traditional: true,
                    success: function (data) {
                        $('#ModalRequisition').removeAttr("disabled");
                        $('#ModalRequisition').empty();
                        $('#ModalItemName').empty();
                        var sites = "<select id='sites'><option value=''>--Select--</option></select>";
                        $('#ModalItemName').html(sites);
                        $('#ModalUnit').val("");
                        $('#ModalUnitName').val("");
                        $('#ModalQty').val("");
                        $('#ModalVendor').val("");
                        $('#ModalQtnNo').val("");
                        $('#ModalQtnDate').val("");
                        $('#ModalUnitPrice').val("");
                        $('#ModalTotal').val("");

                        var listOfitems = data.Items.length;
                        var items = "<select id='ModalRequisition'>";
                        items = items + '<option value="">--Select--</option>';
                        for (var i = 0; i < listOfitems; i++) {
                            items = items + '<option value=' + data.Items[i].Value + '>' + data.Items[i].Text + '</option>';
                        }
                        items = items + '</select>';
                        $('#ModalRequisition').html(items);

                    }

                });
            }
        });

        $("#ModalRequisition").change(function () {
            var Rcode = $('#ModalRequisition  option:selected').text();
            var SiteId = $('#ModalSiteId  option:selected').val();
            var ProjectId = $('#ModalProjectId option:selected').val();

            if ($('#ModalRequisition  option:selected').text() == "--Select--") {
                $('#ModalItemName').empty();
                var sites = "<select id='sites'><option value=''>--Select--</option></select>";
                $('#ModalItemName').html(sites);

                $('#ModalUnit').val("");
                $('#ModalUnitName').val("");
                $('#ModalQty').val("");
                $('#ModalVendor').val("");
                $('#ModalQtnNo').val("");
                $('#ModalQtnDate').val("");
                $('#ModalUnitPrice').val("");
                $('#ModalTotal').val("");
            }
            else {

                $.ajax({
                    type: "post",
                    url: "/TenderQuotation/GetReqitem",
                    data: { Rcode },
                    datatype: "json",
                    traditional: true,
                    success: function (data) {
                        var listOfitems = data.Items.length;

                        $('#ModalItemName').removeAttr("disabled");
                        $('#ModalItemName').empty();
                        $('#ModalUnit').val("");
                        $('#ModalUnitName').val("");
                        $('#ModalQty').val("");
                        $('#ModalVendor').val("");
                        $('#ModalQtnNo').val("");
                        $('#ModalQtnDate').val("");
                        $('#ModalUnitPrice').val("");
                        $('#ModalTotal').val("");

                        var items = "<select id='ModalItemName'>";
                        items = items + '<option value="">--Select--</option>';
                        for (var i = 0; i < listOfitems; i++) {
                            items = items + '<option value=' + data.Items[i].Value + '>' + data.Items[i].Text + '</option>';
                        }
                        items = items + '</select>';
                        $('#ModalItemName').html(items);

                    }

                });
            }
        });

        $("#ModalItemName").change(function () {
            var ItemId = $('#ModalItemName option:selected').val();
            var Rcode = $('#ModalRequisition  option:selected').text();
            var SiteId = $('#ModalSiteId  option:selected').val();

            if( $('#ModalItemName option:selected').text()=="--Select--"){
                $('#ModalUnit').val("");
                $('#ModalUnitName').val("");
                $('#ModalQty').val("");
                $('#ModalVendor').val("");
            }
            else{
                $.ajax({
                    type: "post",
                    url: "/TenderQuotation/GetUnit",
                    data: { ItemId, Rcode ,SiteId},
                    datatype: "json",
                    traditional: true,
                    success: function (data) {
                        $('#ModalUnit').val(data.UnitId);
                        $('#ModalUnitName').val(data.UnitName);
                        $('#ModalQty').val(data.Qty);

                        $('#ModalProc_RequisitionDetId').val(data.Proc_RequisitionDetId);
                    }

                });
            }

        });

        $('#ProjectId').change(function () {
            var id = $('#ProjectId option:selected').val();
            if ($('#ProjectId option:selected').text() == "--Select--")
            {
                $('#SiteId').empty();
                $('#RCode').empty();
                $('#ItemName').empty();

                var sites = "<select id='sites'><option value=''>--Select--</option></select>";

                $('#SiteId').html(sites);
                $('#RCode').html(sites);
                $('#ItemName').html(sites);
                $('#UnitId').val("");
                $('#UnitName').val("");
                $('#ModalQty').val("");
                $('#VendorId').val("");
                $('#Qty').val("");
                $('#TQNo').val("");
                $('#TQDate').val("");
                $('#TQPrice').val("");
                $('#TotalPrice').val("");
            }
            else {
                $.ajax({
                    url: "/TenderQuotation/GetSites",
                    type: "post",
                    data: {
                        ProjectId: id
                    },
                    dataType: "json",
                    success: function (data) {
                        $('#SiteId').removeAttr("disabled");
                        var listOfSites = data.Sites.length;

                        $('#SiteId').empty();
                        $('#RCode').empty();
                        $('#ItemName').empty();
                        var sites = "<select id='sites'><option value=''>--Select--</option></select>";
                        $('#RCode').html(sites);
                        $('#ItemName').html(sites);
                        $('#UnitId').val("");
                        $('#UnitName').val("");
                        $('#ModalQty').val("");
                        $('#VendorId').val("");
                        $('#Qty').val("");
                        $('#TQNo').val("");
                        $('#TQDate').val("");
                        $('#TQPrice').val("");
                        $('#TotalPrice').val("");

                        var sites = "<select id='sites'>";
                        sites = sites + '<option value="">--Select--</option>';
                        for (var i = 0; i < listOfSites; i++) {
                            sites = sites + '<option value=' + data.Sites[i].Value + '>' + data.Sites[i].Text + '</option>';
                        }
                        sites = sites + '</select>';
                        $('#SiteId').html(sites);

                    },
                    error: function (xhr) {
                        alert('error');
                    }
                });
            }
        });


        $("#SiteId").change(function () {
            var SiteId = $('#SiteId').val();
            var ProjectId = $('#ProjectId option:selected').val();
            if ($('#SiteId option:selected').text() == "--Select--")
            {
                $('#RCode').empty();
                $('#ItemName').empty();

                var sites = "<select id='sites'><option value=''>--Select--</option></select>";

                $('#RCode').html(sites);
                $('#ItemName').html(sites);
                $('#UnitId').val("");
                $('#UnitName').val("");
                $('#ModalQty').val("");
                $('#VendorId').val("");
                $('#Qty').val("");
                $('#TQNo').val("");
                $('#TQDate').val("");
                $('#TQPrice').val("");
                $('#TotalPrice').val("");
            }
            else {
                $.ajax({
                    type: "post",
                    url: "/TenderQuotation/GetReqNo",
                    data: { SiteId, ProjectId },
                    datatype: "json",
                    traditional: true,
                    success: function (data) {
                        $('#RCode').removeAttr("disabled");

                        $('#RCode').empty();
                        $('#ItemName').empty();
                        var sites = "<select id='sites'><option value=''>--Select--</option></select>";
                        $('#ItemName').html(sites);
                        $('#UnitId').val("");
                        $('#UnitName').val("");
                        $('#ModalQty').val("");
                        $('#VendorId').val("");
                        $('#Qty').val("");
                        $('#TQNo').val("");
                        $('#TQDate').val("");
                        $('#TQPrice').val("");
                        $('#TotalPrice').val("");
                        var listOfitems = data.Items.length;
                        var items = "<select id='RCode'>";
                        items = items + '<option value="">--Select--</option>';
                        for (var i = 0; i < listOfitems; i++) {
                            items = items + '<option value=' + data.Items[i].Value + '>' + data.Items[i].Text + '</option>';
                        }
                        items = items + '</select>';
                        $('#RCode').html(items);

                    }

                });
            }
        });

        $("#RCode").change(function () {
            var Rcode = $('#RCode  option:selected').text();
            var SiteId = $('#SiteId  option:selected').val();
            var ProjectId = $('#ProjectId option:selected').val();

            if ($('#RCode  option:selected').text() == "--Select--")
            {
                $('#ItemName').empty();
                var sites = "<select id='sites'><option value=''>--Select--</option></select>";
                $('#ItemName').html(sites);
                $('#UnitId').val("");
                $('#UnitName').val("");
                $('#ModalQty').val("");
                $('#VendorId').val("");
                $('#Qty').val("");
                $('#TQNo').val("");
                $('#TQDate').val("");
                $('#TQPrice').val("");
                $('#TotalPrice').val("");
            }
            else {
                $.ajax({
                    type: "post",
                    url: "/TenderQuotation/GetReqitem",
                    data: { Rcode },
                    datatype: "json",
                    traditional: true,
                    success: function (data) {
                        $('#ItemName').removeAttr("disabled");
                        var listOfitems = data.Items.length;

                        var items = "<select id='ItemName'>";
                        items = items + '<option value="">--Select--</option>';
                        for (var i = 0; i < listOfitems; i++) {
                            items = items + '<option value=' + data.Items[i].Value + '>' + data.Items[i].Text + '</option>';
                        }
                        items = items + '</select>';
                        $('#ItemName').html(items);

                        $('#UnitId').val("");
                        $('#UnitName').val("");
                        $('#ModalQty').val("");
                        $('#VendorId').val("");
                        $('#Qty').val("");
                        $('#TQNo').val("");
                        $('#TQDate').val("");
                        $('#TQPrice').val("");
                        $('#TotalPrice').val("");

                    }

                });
            }
        });

        $("#ItemName").change(function () {
            var ItemId = $('#ItemName option:selected').val();
            var Rcode = $('#RCode  option:selected').text();
            var SiteId = $('#SiteId  option:selected').val();

            if ($('#ItemName option:selected').text() == "--Select--") {
                $('#UnitId').val("");
                $('#UnitName').val("");
                $('#ModalQty').val("");
                $('#VendorId').val("");
                $('#Qty').val("");
                $('#TQNo').val("");
                $('#TQDate').val("");
                $('#TQPrice').val("");
                $('#TotalPrice').val("");
            }
            else {
                $.ajax({
                    type: "post",
                    url: "/TenderQuotation/GetUnit",
                    data: { ItemId, Rcode ,SiteId},
                    datatype: "json",
                    traditional: true,
                    success: function (data) {
                        $('#UnitId').val(data.UnitId);
                        $('#UnitName').val(data.UnitName);
                        $('#Qty').val(data.Qty);

                        $('#Proc_RequisitionDetId').val(data.Proc_RequisitionDetId);
                    }

                });
            }
        });


        $(document).on({
            'change': function () {
                var price = $(this).val();
                var quantity = $('#Qty').val();
                var totalPrice = price * quantity;
                if (isNaN(totalPrice)) {
                    alert('Unit Price must be a numeric value!!')
                    $('#TQPrice').val("");
                    $('#TotalPrice').val("");
                }
                else {
                    $('#TotalPrice').val(totalPrice);
                }
            }
        }, 'input[name=unitPrice]');


        $(document).on({
            'change': function () {
                var price = $(this).val();
                var quantity = $('#ModalQty').val();
                var totalPrice = price * quantity;
                if (isNaN(totalPrice)) {
                    //alert('Unit Price must be a numeric value!!')
                    $('#ModalUnitPrice_Error').text('Unit Price must be a numeric value!').show();
                    $('#ModalUnitPrice').val("");
                    $('#ModalTotal').val("");
                }
                else {
                    $('#ModalTotal').val(totalPrice);
                    $('#ModalUnitPrice_Error').hide();
                }
            }
        }, 'input[name=ModalUnitPrice]');

        //add new row
        $('#addNewRow').click(function (event) {
            event.preventDefault();
            counter++;
            var isAllValid = true;

            var ProjectId = $('#ProjectId option:selected').val();
            var ProjectName = $('#ProjectId option:selected').text();
            var SiteId = $('#SiteId option:selected').val();
            var SiteName = $('#SiteId option:selected').text();
            var RCode = $('#RCode option:selected').val();
            var RCodeName = $('#RCode option:selected').text();
            var ItemId = $('#ItemName option:selected').val();
            var ItemName = $('#ItemName option:selected').text();
            var Proc_RequisitionDetId = $('#Proc_RequisitionDetId').val();
            var Qty = $('#Qty').val();
            var UnitId = $('#UnitId').val();
            var UnitName = $('#UnitName').val();
            var VendorId = $('#VendorId option:selected').val();
            var VendorName = $('#VendorId option:selected').text();
            var TQNo = $('#TQNo').val();
            var TQDate = $('#TQDate').val();
            var TQPrice = $('#TQPrice').val();
            var TotalPrice = $('#TotalPrice').val();
            var Status = 'N';
            TenderDetailId++;



            //if (ProjectName.trim() == "" || ProjectName.trim() == "Select Project") {
            //    $('#ProjectName_Error').show();
            //    isAllValid = false;
            //}
            //else {
            //    $('#ProjectName_Error').hide();
            //}
            //if (SiteName.trim() == "" || SiteName.trim() == "Select Site") {
            //    $('#SiteName_Error').show();
            //    isAllValid = false;
            //}
            //else {
            //    $('#SiteName_Error').hide();
            //}
            //if (RCode.trim() == "" || RCode.trim() == "Select Requisition") {
            //    $('#ReqNo_Error').show();
            //    isAllValid = false;
            //}
            //else {
            //    $('#ReqNo_Error').hide();
            //}
            //if (ItemName.trim() == "" || ItemName.trim() == "Select Item") {
            //    $('#ItemName_Error').show();
            //    isAllValid = false;
            //}
            //else {
            //    $('#ItemName_Error').hide();
            //}
            //if (VendorName.trim() == "" || VendorName.trim() == "Select Vendor") {
            //    $('#VendorName_Error').show();
            //    isAllValid = false;
            //}
            //else {
            //    $('#VendorName_Error').hide();
            //}
            //if (TQPrice.trim() == "") {
            //    $('#UnitPrice_Error').show();
            //    isAllValid = false;
            //}
            //else {
            //    $('#UnitPrice_Error').hide();
            //}

            if (ProjectName.trim() == "" || ProjectName.trim() == "--Select--") {
                $('#ProjectName_Error').show();
                isAllValid = false;
            }
            else {
                $('#ProjectName_Error').hide();
            }
            if (SiteName.trim() == "" || SiteName.trim() == "--Select--") {
                $('#SiteName_Error').show();
                isAllValid = false;
            }
            else {
                $('#SiteName_Error').hide();
            }
            if (RCode.trim() == "" || RCode.trim() == "--Select--") {
                $('#ReqNo_Error').show();
                isAllValid = false;
            }
            else {
                $('#ReqNo_Error').hide();
            }
            if (ItemName.trim() == "" || ItemName.trim() == "--Select--") {
                $('#ItemName_Error').show();
                isAllValid = false;
            }
            else {
                $('#ItemName_Error').hide();
            }
            if (VendorName.trim() == "" || VendorName.trim() == "--Select--") {
                $('#VendorName_Error').show();
                isAllValid = false;
            }
            else {
                $('#VendorName_Error').hide();
            }
            if (TQPrice.trim() == "") {
                $('#UnitPrice_Error').show();
                isAllValid = false;
            }
            else {
                if(isNaN(TQPrice.trim())){
                    isAllValid = false;
                    $('#UnitPrice_Error').text("Unit Price must be a numeric value!").show();
                }
                else{
                    if(TQPrice.trim().length>18){
                        isAllValid = false;
                        $('#UnitPrice_Error').text("Unit Pricecannot be greater than 18 characters!").show();
                    }
                    else{
                        $('#UnitPrice_Error').hide();
                    }
                }

            }
            if (TQNo.trim().length > 50) {
                $('#QtnNo_Error').text("Qtn No. can not be greater than 50 characters!").show();
                isAllValid = false;
            }
            else {
                $('#QtnNo_Error').hide();
            }


            //$('table.Resource-list tr').each(function () {
            //    var Item = $(this).find("td input[name=ItemName]").val();
            //    var VName = $(this).find("td input[name=VendorName]").val();
            //    if (ItemName == Item && VendorName == VName.trim()) {
            //        alert('This vendor already exists!');
            //        isAllValid = false;
            //    }
            //});

            $('table.Resource-list tbody tr').each(function () {
                var Itemname = $(this).find("td input[name=ItemId]").val();
                var Vendorname = $(this).find("td input[name=Vendor]").val();

                if (ItemId.trim() == Itemname.trim() && VendorId.trim() == Vendorname.trim()) {
                    alert('Same Vendor against this item exists!');
                    isAllValid = false;
                }

            });


            if (isAllValid) {
                var newRow = jQuery('<tr>'
                     +'<td class="index"><input type="hidden" name="SLNo" value="'+counter+'"/><input type="hidden" name="TenderDetailId" value="'+TenderDetailId+'"/></td>'
                    + '<td><input value="' + ProjectId + '" type="hidden" name="ProjectId"/><label name="label_ProjectName" style="width:150px;">' + ProjectName  + '</label><input type="hidden" value="'+ ProjectName+'" class="form-control" name="ProjectName"  style="width:90px;" disabled="disabled"/></td>'
                    + '<td><input value="' + SiteId + '" type="hidden" name="SiteId"/><label name="label_SiteName" style="width:150px;">' + SiteName  + '</label><input type="hidden" value="'+ SiteName+'" class="form-control" name="SiteName"  style="width:90px;" disabled="disabled"/></td>'
                    + '<td><input value="' + RCode + '" type="hidden" class="form-control" name="ReqCode"/><label name="label_RCodeName" style="width:150px;">' + RCodeName + '</label><input value="' + RCodeName + '" type="hidden" class="form-control" name="RCodeName" style="width:90px;" disabled="disabled"/><input value="' + Proc_RequisitionDetId + '" type="hidden" name="Proc_RequisitionDetId"/></td>'
                    + '<td><input value="' + ItemId + '" type="hidden" name="ItemId"/><label name="label_ItemName" style="width:150px;">' + ItemName  + '</label><input value="' + ItemName + '" class="form-control" type="hidden" name="ItemName" style="width:90px;" disabled="disabled"/></td>'
                    + '<td><input value="' + Qty + '" type="hidden" name="Qty" class="form-control" style="width:90px;" disabled="disabled"/><label name="label_Qty">' +  Qty  + '</label></td>'
                    + '<td><input value="' + UnitId + '" type="hidden" name="UnitId"/><label name="label_UnitName">' + UnitName + '</label><input value="' + UnitName + '" class="form-control" type="hidden" name="UnitName" style="width:90px;" disabled="disabled"/></td>'
                    + '<td><input value="' + VendorId + '" type="hidden" name="Vendor"/><label name="label_VendorName" style="width:150px;">' + VendorName + '<label><input value="' + VendorName + '" class="form-control" type="hidden" name="VendorName" style="width:90px;" disabled="disabled"/></td>'
                    + '<td><input value="' + TQNo + '" type="hidden" name="TQNo" class="form-control" style="width:110px;"/><label name="label_TQNo">' + TQNo + '</label></td>'
                    + '<td><input value="' + TQDate + '" type="hidden" name="TQDate" class="form-control datepicker" style="width:90px;"/><label name="label_TQDate">' + TQDate + '</label></td>'
                    + '<td><input value="' + TQPrice + '" type="hidden" name="TQPrice" class="form-control" style="width:90px;"/><label name="label_TQPrice">' + TQPrice + '<label></td>'
                    + '<td><input value="' + TotalPrice + '" type="hidden" name="TotalPrice" class="form-control" style="width:90px;" disabled="disabled"/><label name="label_TotalPrice">' + TotalPrice + '</label><input  class="Status"  value="' + Status + '" type="hidden" name="Status"/></td>'
                    + '<td> '
                     + '<button type="button" id="editSite" class="btn text-primary-400 btn-flat btn-icon btn-rounded  btn-xs editSite " data-toggle="modal" data-target="#detailForm"><i class="icon-pencil"></i></button>'
                    +' <button class="btn text-warning-600 btn-flat btn-icon btn-rounded"  onclick="$(this).parent().parent().remove();"><i class="icon-cross"></i></button><input type="checkbox"/>'
                    +'</td></tr>');

                RebindDatePicker();

                jQuery('table.Resource-list tbody').append(newRow);

                $('#ProjectId').val("");
                $('#SiteId').val("");
                $('#RCode').val("");
                $('#ItemName').val("");
                $('#Qty').val("");
                $('#UnitName').val("");
                $('#VendorId').val("");
                $('#TQNo').val("");
                $('#TQDate').val("");
                $('#TQPrice').val("");
                $('#TotalPrice').val("");

                $('#SiteId').attr("disabled", true);
                $('#RCode').attr("disabled", true);
                $('#ItemName').attr("disabled", true);

                RebindDatePicker();

                $('.editSite').click(function () {

                    var row = $(this).closest('tr');
                    selRow = $(this).closest('tr');

                    var TaskId = row.find('input[name=TaskId]').val();
                    var ProjectId = row.find('input[name=ProjectId]').val();
                    var ProjectName = row.find('input[name=ProjectName]').val();
                    var SiteId = row.find('input[name=SiteId]').val();
                    var SiteName = row.find('input[name=SiteName]').val();
                    var RCode = row.find('input[name=ReqCode]').val();
                    var itemId = row.find('input[name=ItemId]').val();
                    var Qty = row.find('input[name=Qty]').val();
                    var UnitId = row.find('input[name=UnitId]').val();
                    var UnitName = row.find('input[name=UnitName]').val();
                    var Vendor = row.find('input[name=Vendor]').val();
                    var TQNo = row.find('input[name=TQNo]').val();
                    var TQDate = row.find('input[name=TQDate]').val();
                    var TQPrice = row.find('input[name=TQPrice]').val();
                    var TotalPrice = row.find('input[name=TotalPrice]').val();


                    $('#ModalTaskId').val(TaskId);
                    $('#ModalProjectId').val(ProjectId);
                    $('#ModalSiteId').val(SiteId);
                    $('#ModalRequisition').val(RCode);
                    $('#ModalItemName').val(itemId);
                    $('#ModalQty').val(Qty);
                    $('#ModalUnit').val(UnitId);
                    $('#ModalUnitName').val(UnitName);
                    $('#ModalVendor').val(Vendor);
                    $('#ModalQtnNo').val(TQNo);
                    $('#ModalQtnDate').val(TQDate);
                    $('#ModalUnitPrice').val(TQPrice);
                    $('#ModalTotal').val(TotalPrice);

                });
            }

        });

        $('#SaveItem').click(function (e) {

            if ($.trim($('#TNo').val()) === "") {
                alert('Tender No. required');
                $('#ReqDate').focus();
            }
            else if ($.trim($('#TDate').val()) === "") {
                alert('Please insert Requisition No.');
                $('#Rcode').focus();
            }
            else if ($('.Resource-list tr').length < 2) {
                alert('Please Add Item to this Tender!!');
            }
            else {
                CreateSitePlanTask();
            }
        });

        function CreateSitePlanTask() {

            var isValid = true;

            $(':checkbox').each(function (i) {
                if($(this).is(':checked') ){
                    $(this).closest('tr').find("td:eq(11) input.Status").val('A');
                }
                else{
                    $(this).closest('tr').find("td:eq(11) input.Status").val('N');
                }
            });


            //==========Master Form==========

            var TenderId = $("#TenderId").val();
            var TNo = $("#TNo").val();
            var TDate = $("#TDate").val();
            var Specs = $("#Specs").val();
            var TenderRemarks = $("#TenderRemarks").val();

            if (TNo.trim().length > 50) {
                isValid = false;
                $('#TNo_Error').text("Tender No. cannot be greater than 50 characters!").show();
            }
            else {
                $('#TNo_Error').hide();
            }

            if (Specs.trim().length > 100) {
                isValid = false;
                $('#Specs_Error').text("Specification cannot be greater than 100 characters!").show();
            }
            else {
                $('#Specs_Error').hide();
            }

            if (TenderRemarks.trim().length > 100) {
                isValid = false;
                $('#TenderRemarks_Error').text("Remarks cannot be greater than 100 characters!").show();
            }
            else {
                $('#TenderRemarks_Error').hide();
            }

            //===========Detail Form===========
            var RCode = document.getElementsByName("ReqCode");
            var TenderDetailId = document.getElementsByName("TenderDetailId");
            var Proc_RequisitionDetId = document.getElementsByName("Proc_RequisitionDetId");
            var VendorId = document.getElementsByName("Vendor");
            var TQNo = document.getElementsByName("TQNo");
            var TQDate = document.getElementsByName("TQDate");
            var TQPrice = document.getElementsByName("TQPrice");
            var Status = document.getElementsByName("Status");

            var TenderItems = [];

            if (isValid) {
                var tableCounter = $('#RequisitionDetails tr').length - 1;

                for (var i = 0; i < tableCounter; i++) {
                    TenderItems.push({
                        TenderDetailId:TenderDetailId[i].value,
                        RCode: RCode[i].value,
                        Proc_RequisitionDetId: Proc_RequisitionDetId[i].value,
                        VendorId: VendorId[i].value,
                        TQNo: TQNo[i].value,
                        TQDate: TQDate[i].value,
                        TQPrice: TQPrice[i].value,
                        Status: Status[i].value
                    });
                    console.log('---------->');
                    console.log('RCode: ' + TenderItems[i].RCode);
                    console.log('Proc_RequisitionDetId: ' + TenderItems[i].Proc_RequisitionDetId);
                    console.log('VendorId: ' + TenderItems[i].VendorId);
                    console.log('TQNo: ' + TenderItems[i].TQNo);
                    console.log('TQDate: ' + TenderItems[i].TQDate);
                    console.log('TQPrice: ' + TenderItems[i].TQPrice);
                    console.log('Status: ' + TenderItems[i].Status);
                    console.log('---------->');

                }

                TaskDetails = JSON.stringify({
                    TenderItems: TenderItems,
                    DeleteItems:deleteList,
                    TenderId:TenderId,
                    TNo: TNo,
                    TDate: TDate,
                    Specs: Specs,
                    TenderRemarks: TenderRemarks
                });

                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    type: 'POST',
                    url: '/TenderQuotation/EditTender',
                    data: TaskDetails,
                    success: function (result) {
                        console.log(result);
                        if (result.flag === true) {
                            alert("Record save successfully!");

                            $('#TNo').val("");
                            $('#TDate').val("");
                            $('#Specs').val("");
                            $('#TenderRemarks').val("");

                            window.location.replace("/TenderQuotation/Index");
                        }
                        else {
                            alert(result.message);
                        }

                    },
                    failure: function (response) {
                        alert('error');
                    }
                });
            }
        }


        $('#ApproveItem').click(function(){
            var isApproved ="A";
            var TenderMasId = $("#TenderId").val();
            var approveCounter =0;


            $(':checkbox').each(function (i) {
                if($(this).is(':checked') ){
                    $(this).closest('tr').find("td:eq(11) input.Status").val('A');
                    approveCounter++;
                }
                else{
                    $(this).closest('tr').find("td:eq(11) input.Status").val('N');
                }


            });

            if(approveCounter==0)
            {
                alert('Please select atleast one item');
            }
            else{
                var TenderDetailId = document.getElementsByName("TenderDetailId");
                var RCode = document.getElementsByName("ReqCode");

                var Proc_RequisitionDetId = document.getElementsByName("Proc_RequisitionDetId");
                var VendorId = document.getElementsByName("Vendor");
                var TQNo = document.getElementsByName("TQNo");
                var TQDate = document.getElementsByName("TQDate");
                var TQPrice = document.getElementsByName("TQPrice");
                var Status = document.getElementsByName("Status");

                var TenderItems = [];


                var tableCounter = $('#RequisitionDetails tr').length - 1;

                for (var i = 0; i < tableCounter; i++) {
                    TenderItems.push({
                        TenderDetailId:TenderDetailId,
                        RCode: RCode[i].value,
                        Proc_RequisitionDetId: Proc_RequisitionDetId[i].value,
                        VendorId: VendorId[i].value,
                        TQNo: TQNo[i].value,
                        TQDate: TQDate[i].value,
                        TQPrice: TQPrice[i].value,
                        Status: Status[i].value
                    });
                    console.log('---------->');
                    console.log('RCode: ' + TenderItems[i].RCode);
                    console.log('Proc_RequisitionDetId: ' + TenderItems[i].Proc_RequisitionDetId);
                    console.log('VendorId: ' + TenderItems[i].VendorId);
                    console.log('TQNo: ' + TenderItems[i].TQNo);
                    console.log('TQDate: ' + TenderItems[i].TQDate);
                    console.log('TQPrice: ' + TenderItems[i].TQPrice);
                    console.log('Status: ' + TenderItems[i].Status);
                    console.log('---------->');

                }
                TaskDetails = JSON.stringify({
                    TenderItems: TenderItems,
                    //DeleteItems:deleteList,
                    TenderMasId : TenderMasId,
                    isApproved: isApproved
                });

                $.ajax({
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    type: 'POST',
                    url: '/TenderQuotation/ApproveTender',
                    data: TaskDetails,
                    success: function (result) {
                        console.log(result);
                        if (result.flag === true) {
                            alert("Record approved successfully!");
                            window.location.replace("/TenderQuotation/Index");
                        }
                        else {
                            alert(result.message);
                        }

                    },
                    failure: function (response) {
                        alert('error');
                    }
                });
            }

        });




        function RebindDatePicker() {
            $('.datepicker').datepicker("destroy");
            $('.datepicker').datepicker({
                format: 'dd/mm/yyyy',
                todayHighlight: true,
                autoclose: true,
                todayBtn: true,
            });

        }
    </script>

    <style>
        span.error {
            display: block;
            font-style: italic;
            color: #c12a2a;
            font-size: 90%;
        }

        .scrolling {
            width: 100%;
            /*height: 350px;*/
            overflow-x: scroll;
            overflow-y: scroll;
        }
    </style>
